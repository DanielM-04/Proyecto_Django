{% extends 'baseheader.html' %}
{% block content%}
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ titulo }}</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

<body>
    <div class="container">

        <h1>{{ titulo }}</h1>

        {% if carrito %}
        <h3>Detalles del Carrito:</h3>
        <ul>
            <li>ID del Carrito: {{ carrito.id }}</li>
            <li>Usuario: {{ carrito.usuario.username }}</li>
            <li>Fecha de creaci칩n: {{ carrito.fecha_creacion }}</li>
            <li>Total del Carrito: ${{ carrito.total_carrito }}</li>
        </ul>

        {% if item %}
        <h3>Items en el carrito:</h3>
        <ul>
            {% for item_carrito_obj in item %}
            <li>
                Producto: {{ item_carrito_obj.producto.nombre }} (ID del Item: {{ item_carrito_obj.id }})
                <ul>
                    <li>Precio Unitario: ${{ item_carrito_obj.precio_unitario }}</li>
                    <li>Cantidad: {{ item_carrito_obj.cantidad }}</li>
                    <li>Subtotal: ${{ item_carrito_obj.subtotal }}</li>
                </ul>
                {% if item_carrito_obj.precio_unitario < 10 %} <p><em>Precio unitario de este item es menor a 10.</em></p>
                    {% elif item_carrito_obj.precio_unitario >= 10 and item_carrito_obj.precio_unitario < 20 %} <p><em>Precio
                            unitario de este item es mayor o igual a 10 y menor a 20.</em></p>
                        {% else %}
                        <p><em>Precio unitario de este item es mayor o igual a 20.</em></p>
                        {% endif %}
                <span class="item-actions">
                    <form method="POST" action="{% url 'eliminar_item_carrito' item_carrito_obj.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-eliminar">Eliminar Item</button>
                    </form>
                </span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>No hay items en este carrito.</p>
        {% endif %}
        <hr>
        <h4>Acciones del Carrito:</h4>
        <div class="button-group">
            <form method="POST" action="{% url 'eliminar_carrito' carrito.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-eliminar">Eliminar Carrito Completo</button>
            </form>
        </div>
        
        <h4>A침adir Item al Carrito:</h4>
        <form method="POST" action="">
            {% csrf_token %}
            <label for="id_producto" class="label">ID Producto:</label>
            <input type="number" id="id_producto" name="id_producto" required>
            <label for="cantidad" class="label">Cantidad:</label>
            <input type="number" id="cantidad" name="cantidad" value="1" min="1" required>
            <button type="button" onclick="construirUrlAgregarItemYRedirigir({{ carrito.id }})" class="btn">A침adir Item</button>
        </form>
        <script>
            function construirUrlAgregarItemYRedirigir(idCarrito) {
                const idProducto = document.getElementById('id_producto').value;
                const cantidad = document.getElementById('cantidad').value;
                if (idProducto && cantidad) {
                    window.location.href = `/ventas/agregar-item-carrito/${idCarrito}/${idProducto}/${cantidad}/`;
                } else {
                    alert("Por favor, ingrese ID de Producto y Cantidad.");
                }
            }
        </script>

        {% else %}
        <p>No se encontr칩 el carrito que buscabas. Puedes generar uno nuevo o realizar otras acciones.</p>
        {% endif %}

        <hr>
        <h4>Otras Acciones:</h4>
        <div class="button-group">
            <a href="{% url 'ventas_generales' %}" class="btn btn-volver">Ver Ventas Generales</a>
            
            {% if carrito %}
            <form method="POST" action="{% url 'generar_carrito_para_usuario' carrito.usuario.id %}">
                {% csrf_token %}
                <button type="submit" class="btn">Re-Generar Carrito para {{ carrito.usuario.username }} (si no existe)</button>
            </form>
            {% else %}
            <form method="POST" action="{% url 'generar_nuevo_usuario_y_carrito' %}">
                {% csrf_token %}
                <button type="submit" class="btn">Generar Nuevo Usuario y Carrito</button>
            </form>
            {% endif %}

            <form method="POST" action="{% url 'generar_usuario' %}">
                {% csrf_token %}
                <button type="submit" class="btn">Generar Usuario de Prueba</button>
            </form>
            <form method="POST" action="{% url 'generar_registro' %}">
                {% csrf_token %}
                <button type="submit" class="btn">Generar Producto de Prueba</button>
            </form>
        </div>

    </div>
</body>

</html>
{%endblock%}